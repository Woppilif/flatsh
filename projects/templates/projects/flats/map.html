{% load l10n %}

<script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=basic"></script>
<div id="map" ></div>

<script>
    DG.then(function() {
        var map;

        var container = document.createElement('div'),
                    mapBlock = document.getElementById('map');

        container.id = 'map';
        container.style.width = screen.width;
        container.style.height = '400px';
        mapBlock .appendChild(container);

        map = DG.map('map', {
            center: [55.797602, 49.099868],
            zoom: 15,
            fullscreenControl: false,
            zoomControl: false,
            width:"100%"
        });
        {%for flat in flats%}
            DG.marker([{{flat.latitude|unlocalize}}, {{flat.longitude|unlocalize}}]).addTo(map).on('click', function () {
                clickOnFlat({{flat.pk}},0);
            });
        {%endfor%}

        map.locate({setView: true, watch: false})
            .on('locationfound', function(e) {
                DG.marker([e.latitude, e.longitude]).addTo(map).bindPopup('Вы находитесь здесь!');
            })
            .on('locationerror', function(e) {
                DG.popup()
                    .setLatLng(map.getCenter())
                    .setContent('Доступ к определению местоположения отключён')
                    .openOn(map);
            });
    });

    
</script>